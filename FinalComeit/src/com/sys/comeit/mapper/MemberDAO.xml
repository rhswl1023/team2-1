<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.sys.comeit.IMemberDAO">

<!-- 멤버 정보 조회 list() -->
<select id="memberList" resultType="com.sys.comeit.MemberDTO">
	SELECT ID, MEM_CD, NAME, EMAIL, TEL, 
		   IDNTT, MEM_CONTENT, AREA_NAME, SPC_AREA_NAME, IMG_URL , JOINDATE , PWD
	FROM VIEW_MEM_MY
</select>

<!-- 총 멤버 회원 수 조회 count() -->
<select id="memberCount" resultType="java.lang.Integer">
	SELECT COUNT(*) AS COUNT
	FROM TBL_MEM_JOIN
</select>

<!-- 로그인 -->
<select id="memberLogin" resultType="java.lang.String">
      SELECT NAME
      FROM TBL_MEM_JOIN
      WHERE MEM_ID=#{id}
      AND PWD=CRYPTPACK.ENCRYPT(#{pwd},#{pwd})
</select>


<!-- 로그인시 조회될 정지여부 -->
<select id="memStop" resultType="java.lang.String">
	SELECT STOP_DATE
	FROM VIEW_MEM_STOP
	WHERE ID = #{id}
</select>

<!-- 블락회원 조회 -->
<select id="memBlock" resultType="java.lang.Integer">
	SELECT COUNT(*) AS COUNT
	FROM VIEW_MEM_BLK
	WHERE ID = (SELECT ID
           		FROM VIEW_MEM_STOP
           		WHERE ID = #{id})
</select>

	 
<!-- 일반 회원 id 찾기 -->
<select id="memId" resultType="java.lang.String">
	SELECT MEM_ID
	FROM TBL_MEM_JOIN
	WHERE NAME=#{name}
	AND TEL=#{tel}
</select>

<!-- 일반 회원 가입 -->
<insert id="memberAdd" parameterType="com.sys.comeit.MemberDTO" statementType="CALLABLE">
   { CALL PRC_MEM_JOIN
      (
         #{mem_id, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{name, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{email, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{tel, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{pwd, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{idntt_cd, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{img_url, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{content, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{spc_area_cd, mode=IN, jdbcType=VARCHAR, javaType=string}
         , #{mem_cd_out, mode=OUT, jdbcType=VARCHAR, javaType=string}
      )
   }
</insert>

<!-- 일반 회원 pwd 찾기 -->
<update id="memPwd">
	UPDATE TBL_MEM_JOIN
	SET PWD=CRYPTPACK.ENCRYPT(#{pwd},#{pwd})
	WHERE NAME=#{name}
	AND MEM_ID=#{id}
	AND TEL=#{tel}
</update>
</mapper>