<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.sys.comeit.IStudyDAO">

   <!-- 스터디방 정보 조회 -->
	<select id="studyInfoSearch"
		resultType="com.sys.comeit.StudyDTO">
		SELECT STU_CD,CRT_DATE ,TITLE,STR_DATE,MEM_NUM, CONTENT, CMT_DATE,
		STU_JOIN_CD
		, STU_HIST_CD, APNTM_DATE, AREA_NAME, SPC_AREA_NAME
		, MEET_TERM, IDNTT_TYPE, LV, CAT_NAME, LEADER_MEM_CD, LEADER_ID
		, LEADER_NAME, SCRT_NUM, CRT_MEM_CD, END_DATE
		FROM VIEW_STU_INFO
		WHERE STU_CD=#{stu_cd}
	</select>

	<!-- 스터디방 관심 태그 조회 -->
	<select id="studyIntTagSearch"
		resultType="com.sys.comeit.StudyDTO">
		SELECT INT_TAG AS INT_TAG_NAME
		FROM VIEW_STU_TAG
		WHERE STU_CD = #{stu_cd}
	</select>
	
	<!-- 스터디방 기타 관심 태그 조회 -->
	<select id="studyEtcTagSearch"
		resultType="com.sys.comeit.StudyDTO">
		SELECT ETC_TAG AS ETC_TAG_NAME
		FROM VIEW_STU_ETC_TAG
		WHERE STU_CD = #{stu_cd}
	</select>
	
	<!-- 스터디 진행 요일 조회 -->
	<select id="studyDaySearch" 
		resultType="com.sys.comeit.StudyDTO">
		SELECT D.DAY_NAME AS STU_DAY_NAME
		FROM TBL_STU_PRG_DAY SD, TBL_DAY D
		WHERE SD.DAY_CD = D.DAY_CD
		  AND SD.STU_CD=#{stu_cd}
	</select>
	
	<!-- 스터디장 조회 -->
	<select id="studyLeaderSearch" resultType="com.sys.comeit.StudyDTO">
		SELECT DISTINCT LEADER_NAME, LEADER_MEM_CD
		FROM VIEW_STU_INFO
		WHERE STU_CD = #{stu_cd}
		  AND APNTM_DATE = (
		                    SELECT MAX(APNTM_DATE)
		                    FROM VIEW_STU_INFO
		                    WHERE STU_CD =#{stu_cd}
                    		)
	</select>
	
	<!-- 스터디원 조회 -->
	<select id="studyJoinName" 
	resultType="com.sys.comeit.StudyDTO">
		SELECT NAME AS STU_JOIN_NAME, MEM_CD AS JOIN_MEM_CD
		FROM VIEW_MY_STU
		WHERE STU_CD = #{stu_cd}
		  AND EXT_NAME IS NULL
	</select>
	
	<!-- 스터디장/원 이미지 조회 -->
	<select id="memImgSearch" resultType="com.sys.comeit.StudyDTO">
		SELECT MJ.MEM_CD AS JOIN_MEM_CD, MI.IMG_URL AS MEM_IMG
		FROM TBL_MEM_IMG MI, TBL_MEM_JOIN MJ, TBL_STU_JOIN SJ
		WHERE MJ.MEM_ID = MI.MEM_ID
		  AND MJ.MEM_CD = SJ.MEM_CD
		AND SJ.STU_CD = (SELECT DISTINCT STU_CD
		                 FROM VIEW_MY_STU
		                 WHERE STU_CD = #{stu_cd}
		                   AND EXT_NAME IS NULL)
	</select>
   
   <!-- 수진 추가 -->
   <!-- 전체 스터디방 조회 -->
   <select id="studyList" resultType="com.sys.comeit.StudyDTO">
      SELECT STU_CD, CRT_DATE, TITLE, STR_DATE, MEM_NUM, CMT_DATE, AREA_NAME, SPC_AREA_NAME, MEET_TERM, IDNTT_TYPE, LV, CAT_NAME, SCRT_NUM, END_DATE
      FROM VIEW_STU_LIST
      WHERE STR_DATE <![CDATA[<]]> SYSDATE AND END_DATE <![CDATA[>]]> SYSDATE
   </select>
   
   <!-- 전체 스터디방 개수 조회 -->
   <!-- 총 멤버 회원 수 조회 count() -->
   <select id="studyCount" resultType="java.lang.Integer">
      SELECT COUNT(*) AS COUNT
      FROM VIEW_STU_LIST
      WHERE STR_DATE <![CDATA[<]]> SYSDATE AND END_DATE <![CDATA[>]]> SYSDATE
   </select>
   
   <!-- 모든 스터디방의 각 관심 키워드 -->
   <select id="studyTagList" resultType="com.sys.comeit.StudyDTO">
      <![CDATA[
      	SELECT STU_CD, INT_TAG AS INT_TAG_NAME
		FROM 
		(
		SELECT STU_CD, INT_TAG, STR_DATE, END_DATE
		FROM VIEW_STU_TAG
		UNION ALL
		SELECT STU_CD, ETC_TAG, STR_DATE, END_DATE
		FROM VIEW_STU_ETC_TAG
		)
		WHERE STR_DATE < SYSDATE AND END_DATE > SYSDATE
      ]]>
   </select>
   
</mapper>