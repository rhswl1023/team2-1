<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.sys.comeit.ILectureDAO">

	<!-- <insert id="lectureInsert">
		INSERT INTO TBL_LEC(LEC_CD, PROF_CD, SPC_AREA_CD
		, LEC_TERM_CD, LEC_NAME, CRT_DATE, STR_DATE, LEC_FEE
		, LEC_INTRO, MIN_MEM, MAX_MEM)
		VALUES('LEC' || SEQ_LEC.NEXTVAL, 'PROF1001', #{spc_area_cd}
		, #{lec_term_cd}, #{lec_name}, SYSDATE, #{str_date} , #{lec_fee}
		, #{lec_intro}, #{min_mem}, #{max_mem})
	</insert> -->
	
	<select id="lectureInsert" parameterType="com.sys.comeit.LectureDTO" statementType="CALLABLE">
	   { CALL PRC_LEC_CRT
	      (
	           #{prof_cd}
	         , #{spc_area_cd}
	         , #{lec_term_cd}
	         , #{lec_name}
	         , #{str_date}
	         , #{lec_fee}
	         , #{lec_intro}
	         , #{min_mem}
	         , #{max_mem}
	         , #{lec_cd, mode=OUT, jdbcType=VARCHAR}
	      )
	   }
	</select>
	
	<insert id="insertIntTag">
		INSERT INTO TBL_LEC_INT_TAG(LEC_INT_TAG_CD, INT_TAG_CD, LEC_CD)
		VALUES('LECIT' || SEQ_LEC_INT_TAG.NEXTVAL, #{int_tag_cd}, #{lec_cd})
	</insert>
	
	<insert id="insertEtcTag">
		INSERT INTO TBL_LEC_INT_ETC_TAG(LEC_INT_ETC_TAG_CD, LEC_CD, ETC_TAG)
		VALUES('LECET' || SEQ_LEC_INT_ETC_TAG.NEXTVAL, #{lec_cd}, #{etc_tag})
	</insert>
	
	<select id="etcTagCount" resultType="java.lang.Integer">
		SELECT COUNT(*) AS COUNT
		FROM TBL_LEC_INT_ETC_TAG
		WHERE ETC_TAG=#{etc_tag}
	</select>
	
	<insert id="addTagName">
		INSERT INTO TBL_INT_TAG(INT_TAG_CD, INT_TAG)
		VALUES('INT'||SEQ_INT_TAG.NEXTVAL, #{etc_tag})
	</insert>
	
	<insert id="addLecturePrgTime">
		INSERT INTO TBL_LEC_PRG_TIME(LEG_PRG_TIME_CD, LEC_CD, DAY_CD
		, STR_HRS, END_HRS)
		VALUES('LECPT' || SEQ_LEC_PRG_TIME.NEXTVAL, #{lec_cd}, #{day_cd}
		, #{str_hrs}, #{end_hrs})
	</insert>
	
	<!-- 전체 강의방 조회 -->
   <select id="lecList" resultType="com.sys.comeit.LectureDTO">
      SELECT STU_CD, CRT_DATE, TITLE, STR_DATE, MEM_NUM, CMT_DATE
      , AREA_NAME, SPC_AREA_NAME, MEET_TERM
      , IDNTT_TYPE, LV, CAT_NAME, SCRT_NUM, END_DATE
      FROM VIEW_STU_LIST
      WHERE END_DATE <![CDATA[>]]> SYSDATE
      ORDER BY CRT_DATE DESC
   </select>
   
	<!-- 총 스터디방 개수 조회 count() -->
   <select id="lecCount" resultType="java.lang.Integer">
      SELECT COUNT(*) AS COUNT
      FROM VIEW_STU_LIST
      WHERE END_DATE <![CDATA[>]]> SYSDATE
   </select>
   
   <!-- 모든 스터디방의 관심 키워드 -->
   <select id="lecTagList" resultType="com.sys.comeit.LectureDTO">
      <![CDATA[
      	SELECT STU_CD, INT_TAG AS INT_TAG_NAME
		FROM 
		(
		SELECT STU_CD, INT_TAG, STR_DATE, END_DATE
		FROM VIEW_STU_TAG
		UNION ALL
		SELECT STU_CD, ETC_TAG, STR_DATE, END_DATE
		FROM VIEW_STU_ETC_TAG
		)
		WHERE END_DATE > SYSDATE
      ]]>
   </select>
   
	
</mapper>